#!/usr/bin/env python3
"""
Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ topics.json
"""

import json
import os

TOPICS_FILE = "data/topics.json"

def fix_topics_file():
    """ØªØ¨Ø¯ÛŒÙ„ topics.json Ø§Ø² dict Ø¨Ù‡ list"""
    
    print("ğŸ”§ Ø´Ø±ÙˆØ¹ Ø§ØµÙ„Ø§Ø­ ÙØ§ÛŒÙ„ topics.json...")
    
    # Ø³Ø§Ø®Øª Ù¾ÙˆØ´Ù‡ data Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
    os.makedirs("data", exist_ok=True)
    
    # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
    if os.path.exists(TOPICS_FILE):
        try:
            with open(TOPICS_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            print(f"ğŸ“„ Ù†ÙˆØ¹ ÙØ¹Ù„ÛŒ: {type(data).__name__}")
            
            if isinstance(data, dict):
                print("âš ï¸  ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ dict Ø§Ø³ØªØŒ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ list...")
                # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ
                with open(TOPICS_FILE, 'w', encoding='utf-8') as f:
                    json.dump([], f, ensure_ascii=False, indent=2)
                print("âœ… ÙØ§ÛŒÙ„ Ø¨Ù‡ list ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯")
            else:
                print("âœ… ÙØ§ÛŒÙ„ Ø§Ø² Ù‚Ø¨Ù„ list Ø§Ø³Øª")
        
        except Exception as e:
            print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„: {e}")
            print("ğŸ”„ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯...")
            with open(TOPICS_FILE, 'w', encoding='utf-8') as f:
                json.dump([], f, ensure_ascii=False, indent=2)
            print("âœ… ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    else:
        print("ğŸ“ ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯...")
        with open(TOPICS_FILE, 'w', encoding='utf-8') as f:
            json.dump([], f, ensure_ascii=False, indent=2)
        print("âœ… ÙØ§ÛŒÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯")
    
    print("\nâœ¨ Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!")
    print(f"ğŸ“‚ Ù…Ø³ÛŒØ±: {os.path.abspath(TOPICS_FILE)}")


if __name__ == "__main__":
    fix_topics_file()
